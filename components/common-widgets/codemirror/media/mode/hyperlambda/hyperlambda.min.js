(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";n.defineMode("hyperlambda",function(){return{styles:{comment:"comment",string:"string",value:"property",keyword:"keyword",variable:"variable",activeevent:"variable-2",type:"def",expression:"number",error:"error",small_error:"bracket"},indent:function(n){return n.indent},startState:function(){return{mode:"name",indent:0,previousIndent:0,noContent:!0}},token:function(n,t){switch(t.mode){case"name":return this.tokenizeNameMode(n,t);case"value":return this.tokenizeValueMode(n,t);case"mcomment":return this.tokenizeMultiCommentMode(n,t);case"mstring-name":return this.tokenizeMultilineStringMode(n,t,!0);case"mstring-value":return this.tokenizeMultilineStringMode(n,t,!1);case"error":return n.skipToEnd(),this.styles.error}},tokenizeNameMode:function(n,t){for(var r=0,f,i,u;n.peek()==" ";)r+=1,n.next();f=null;i=n.peek();switch(i){case'"':return(t.noContent=!1,n.next(),this.checkIndentation(t,r)===!0)?this.styles.error:this.parseSingleLineStringLiteral(n,t);case"@":if(this.checkIndentation(t,r)===!0)return this.styles.error;if(t.noContent=!1,n.next(),i+=n.next(),i=='@"')return t.mode="mstring-name",t.oldIndent=t.indent,t.indent=0,this.tokenizeMultilineStringMode(n,t,!0);break;case":":return this.checkIndentation(t,r)===!0?this.styles.error:(t.noContent=!1,t.mode="value",this.styles.type);case"/":if(n.next(),n.peek()=="/")return this.parseSingleLineComment(n,t);if(n.peek()=="*")return t.mode="mcomment",this.tokenizeMultiCommentMode(n,t)}if(n.next(),i!=null&&this.checkIndentation(t,r)===!0)return this.styles.error;for(u=i;;){if(i=n.peek(),i==null){n.next();break}else if(i==":")break;else n.next();u+=i}return i==":"&&(t.mode="value",f=this.styles.type),t.noContent=!1,u!=null&&u.length>0&&(f=this.getNodeNameType(u,t)),f},tokenizeValueMode:function(n,t){if(this.is_ex===!0)return t.mode="name",this.is_ex=!1,this.parseLambdaExpression(n,t);var i=n.next(),r=this.styles.value;switch(i){case'"':return t.mode="name",this.parseSingleLineStringLiteral(n,t);case"@":if(i=n.peek(),i=='"')n.next(),t.mode="mstring-value",t.oldIndent=t.indent,t.indent=0,r=this.tokenizeMultilineStringMode(n,t,!1);else for(t.mode="name";n.next()!=null;);break;case":":r=this.styles.type;n.peek()==null&&(t.mode="name");break;default:for(;;)if(i=n.next(),i==null){t.mode="name";break}else if(i==":"){if(n.peek()==null){t.mode="name";break}n.string.substring(n.start,n.pos-1)=="x"&&(this.is_ex=!0);r=this.styles.type;break}}return r},tokenizeMultiCommentMode:function(n,t){n.skipToEnd();var i=n.current();if(i.indexOf("*/",i.length-2)!=-1)t.mode="name";else if(i.indexOf("*/")!=-1)return t.mode="error",this.styles.error;return this.styles.comment},tokenizeMultilineStringMode:function(n,t,i){for(var r=n.next(),u=!1,f;r!=null;)if(r=='"'&&n.peek()!='"'){u=!0;break}else if(r=='"'){for(f=r;r=='"';)r=n.peek(),r=='"'&&(f+=r,n.next());if(f.length%2==1){u=!0;break}}else r=n.next();if(u){if(t.indent=t.oldIndent,r=n.peek(),!i&&r!=null)return t.mode="error",this.styles.error;if(r==null)t.mode="name";else if(r==":")t.mode="value";else return t.mode="error",this.styles.error}return this.styles.string},parseSingleLineStringLiteral:function(n,t){for(var i=n.next(),r="";;){if(i=='"'&&r!="\\"){if(n.eatSpace(),n.peek()!=null&&n.peek()!=":")return t.mode="error",n.skipToEnd(),this.styles.error;break}if(i==null)return t.mode="error",this.styles.error;r=i;i=n.next()}return this.styles.string},parseLambdaExpression:function(n){return n.skipToEnd(),this.styles.expression},parseSingleLineComment:function(n){return n.skipToEnd(),this.styles.comment},checkIndentation:function(n,t){return t%2!=0?(n.mode="error",!0):t-n.previousIndent>2||t==2&&n.noContent===!0?(n.mode="error",!0):(n.indent=t,n.previousIndent=t,!1)},getNodeNameType:function(t){return n._hyperlispKeywords!=null&&n._hyperlispKeywords.indexOf(t)!=-1?t.indexOf(".")==-1?this.styles.keyword:this.styles.activeevent:t[0]=="_"?this.styles.variable:t[0]=="."||t.indexOf("on")==0||t.indexOf("_on")==0?this.styles.keyword:t.indexOf(".")!=-1?this.styles.small_error:void 0}}});n.defineMIME("text/x-hyperlambda","hyperlambda");n.registerHelper("hint","hyperlambda",function(t){var i;if(n._hyperlispKeywords!=null){var r=t.getCursor(),u=r.ch,f=[],o=t.getLine(r.line),e=o.trim(),s=u-e.length;for(i=0;i<n._hyperlispKeywords.length;i++)n._hyperlispKeywords[i].indexOf(e)!=-1&&f.push(n._hyperlispKeywords[i]);return{list:f,from:n.Pos(r.line,s),to:n.Pos(r.line,u)}}})});